<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@kehers">
  <meta name="twitter:title" content="jquery.listSort.js">
  <meta name="twitter:description" content="
We have been revamping Prowork. While doing some housekeep over the weekend, I noticed I wrote the [task] drag and sort feature on the current version from scratch. So as part of the housekeep, I...">
  <meta name="twitter:creator" content="@kehers">
  <title>jquery.listSort.js</title>
  <link href='https://fonts.googleapis.com/css?family=Libre+Baskerville:400,700' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Muli' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/css/normalize.css">
  <link rel="stylesheet" href="/assets/css/skeleton.css">
  <link rel="stylesheet" href="/assets/css/custom.css">
  <link rel="stylesheet" href="/assets/css/zenburn.css" />
  <link rel="alternate" type="application/atom+xml" title="Blog post feed" href="/feed.xml">
</head>
<body>

<div class="container">
  <header>
    <div class="row">
      <div id="logo" class="three columns">
      <div id="menu">☰</div>
      <h3><a href="/">/opeyemi</a></h3>
    </div>
      <nav class="nine columns">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/posts.html">Posts</a></li>
          <li><a href="/feed.xml">RSS Feed</a></li>
          <li><a href="http://gum.co/Sxoj" class="bordered">Consuming REST APIs - a soft introduction</a></li>
      </ul>
      </nav>
    </div>
  </header>
  <div class="row">
    <div class="six offset-by-three columns">
      <article>
        <date>06 May 2013</date>
        <h1 class="title">jquery.listSort.js</h1>
        <style>
.sort b{
cursor:move
}
.hit{
background-color:#f2f4fa
}
</style>
<p>We have been revamping <a href="http://prowork.me">Prowork</a>. While doing some <i>housekeep</i> over the weekend, I noticed I wrote the [task] drag and sort feature on the current version from scratch. So as part of the housekeep, I converted it to a jQuery plugin - <a href="https://github.com/kehers/jquery.listSort.js">jquery.listSort.js</a></p>
<p><b>Why another drag and sort (drop, whatever) plugin?</b></p>
<p>Back then, I searched for existing plugins (not based on jQuery UI) for the purpose. I found some really good ones but most didn't work for the task list mainly becase the list element contains other collapsible elements (notes, members, dates, etc). Many also break when the list is sorted (by status or created/due dates as we have) or filtered (my task, a team member's task or all tasks). And there is always position issues as most plugins miss the fact that the dragged element may be contained in a parent with a relative position. So using an offset relative to the document (instead of the relative parent) as the absolute position for the clone will always fail. Another one - what happens when you are dragging an element to a position far below the window? Does the window scroll automatically or you are just left hanging there at the bottom of the current view?</p>
<p>Long story short, I had to write one.</p>
<p>The plugin has the following options (all optional):</p>
<ul class="sort">
	<li>
		<p><b>dragElement</b><br />
		You may want to have an element within the list as your drag anchor. Don't forget to set the CSS property for the element though <i>(cursor: move)</i>. The plugin doesn't do that for you. If this is not set, it means you can drag the whole element.</p>
	</li>
	<li>
		<p><b>cloneClass</b><br />
		CSS class to add to the cloned copy of the element.</p>
	</li>
	<li>
		<p><b>dropClass</b><br />
		CSS class to add to the element at the location the currently dragged element can be dropped.</p>
	</li>
	<li>
		<p><b>customClone</b><br />
		By default, the plugin clones the whole element. Sometimes, we want to clone just a part of the element. The plugin sends the element being dragged as an argument to this function. Simply return your custom clone object. At Prowork for example, the only thing I need is the task title.</p>
<p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">'li.task'</span><span class="p">).</span><span class="nx">listSort</span><span class="p">({</span>
  <span class="s1">'customClone'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">$obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'&lt;div&gt;'</span><span class="o">+</span><span class="nx">$</span><span class="p">(</span><span class="s1">'p.task-title'</span><span class="p">,</span> <span class="nx">$obj</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span><span class="o">+</span><span class="s1">'&lt;/div&gt;'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure></p>
	</li>
	<li>
		<p><b>onStartDrag</b><br />
		If you need to do some things before the drag starts, here is your cue.
		</p>
<p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">'li.task'</span><span class="p">).</span><span class="nx">listSort</span><span class="p">({</span>
  <span class="s1">'onStartDrag'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Collapse all 'opened' tasks</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">'li.dropdown'</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">'.taskdrop'</span><span class="p">,</span> <span class="k">this</span><span class="p">).</span><span class="nx">hide</span><span class="p">(</span><span class="s1">'fast'</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">'dropdown'</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure></p>
	</li>
	<li>
		<p><b>onEndDrag</b><br />
		Ok, we are done, what's next? Save the new order to db maybe?
		</p>
<p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="s1">'li.task'</span><span class="p">).</span><span class="nx">listSort</span><span class="p">({</span>
  <span class="s1">'onEndDrag'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">order</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">order</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">'id'</span><span class="p">).</span><span class="nx">match</span><span class="p">(</span><span class="sr">/task</span><span class="se">\-(</span><span class="sr">.+</span><span class="se">)</span><span class="sr">$/</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
	<span class="p">}).</span><span class="nx">get</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s2">"path/to/ajax/server/sort-list"</span><span class="p">,</span> <span class="p">{</span> <span class="s2">"ids[]"</span><span class="p">:</span> <span class="nx">data</span> <span class="p">});</span>
  <span class="p">}</span>
<span class="p">});</span></code></pre></figure></p>
	</li>
</ul>
<p><b>Demo?</b></p>
<p>Try re-sort the [plugin] options I mentioned above by dragging the title. Here is the setup:</p>
<p><figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">'ul.sort li'</span><span class="p">).</span><span class="nx">listSort</span><span class="p">({</span>
    <span class="s1">'dragElement'</span><span class="p">:</span><span class="s1">'b'</span><span class="p">,</span>
    <span class="s1">'dropClass'</span><span class="p">:</span><span class="s1">'hit'</span><span class="p">,</span>
    <span class="s1">'onEndDrag'</span><span class="p">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">order</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">order</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
	    <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s1">'b'</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)).</span><span class="nx">text</span><span class="p">();</span>
	  <span class="p">}).</span><span class="nx">get</span><span class="p">();</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span></code></pre></figure></p>
<p>On a final note, I removed and added a couple of things when converting to a jQuery plugin. If somethings don't work, or you have issues somewhere, submit an <a href="https://github.com/kehers/jquery.listSort.js/issues">issue</a> or <a href="http://twitter.com/kehers">let me know</a>. Plus be free to fork, iterate and pull.</p>
<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
<script src="http://prowork.me/js/jquery.list-sort.js"></script>
<script>
	$(function() {
		$('ul.sort li').listSort({
			'dragElement':'b',
			'dropClass':'hit',
			'onEndDrag': function (order) {
				var data = $(order).map(function() { return $('b', $(this)).text(); }).get();
				console.log(data);
			}
		});
	});
</script>
      </article>
    </div>
  </div>
</div>
<div class="colophon">
  <div class="container">
    <div class="row">
      <div class="author six offset-by-three columns">
        <img src="https://igcdn-photos-f-a.akamaihd.net/hphotos-ak-xfp1/t51.2885-15/e15/10617063_553407278119581_1973098870_n.jpg" class="avi"> <p>My name is Opeyemi Obembe. I build things for web and mobile. You should follow me on Twitter (<a href="http://twitter.com/kehers">@kehers</a>).</p>
      </div>
    </div>
    <div class="row p-t-20">
      <div class="six offset-by-three columns">
        
        
        
        <article class="m-t-20">
          <h4 class="title m-b-20">Next post</h4>
          <h5 class="libre no-margin"><a href="/2013/04/13/disabling-google-search-tracking.html">Disabling Google Search tracking</a></h5>
        </article>
        
        <h4 class="title">Comments</h4>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_shortname = 'kehers';
          (function() {
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="row">
      <div class="three offset-by-three columns">
        <a href="/">/opeyemi</a> · <a href="http://github.com/kehers/kehers.github.com">Source</a> · <a href="/feed.xml">RSS feed</a>
      </div>
      <div class="three columns">
        <a href="http://twitter.com/kehers">Twitter</a> · <a href="http://github.com/kehers">Github</a> · <a href="http://instagram.com/kehers">Instagram</a> · <a href="http://500px.com/kehers">500px</a>
    </div>
    </div>
  </div>
</footer>

<script type="text/javascript" src="/assets/js/menu.js"></script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-53373832-1', 'auto');
ga('send', 'pageview');
</script>

</body>
</html>