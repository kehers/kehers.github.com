<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width; initial-scale=1.0">
  <title>The Twitter api: the max_id timeline param | Opeyemi's BS</title>
  <link href="http://fonts.googleapis.com/css?family=Libre+Baskerville" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/assets/css/style.css" />
  <link rel="stylesheet" href="/assets/css/zenburn.css" />
  <link rel="alternate" type="application/atom+xml" title="Feed for blog posts" href="/feed.xml">
</head>
<body>
  <div class="wrapper">
    <nav>
      <a href="/">home</a> &middot; <a href="/posts.html">posts</a> &middot; <a href="/feed.xml">feed</a>
    </nav>
    <header>
        <h1>The Twitter api: the max_id timeline param</h1>
        <time>13 Jan 2012</time>
    </header>
    <article>
        <p>I have been making some improvements to <a href="http://twhii.com/">Twhii</a> of late. Memory management, better sign-on process and all that. Among the numerous others, one thing that has come with the update is adding a 'Load More' button to load more tweets.</p>
<p>The 'load more' functions differently from loading new tweets. Actually, this loads previous tweets. Loading new tweets uses the since_id parameter in related timeline APIs while loading previous tweets uses the max_id parameter (see <a href="https://dev.twitter.com/docs/api/1/get/statuses/home_timeline">https://dev.twitter.com/docs/api/1/get/statuses/home_timeline</a> for sample doc). In other words, if you have a stream of tweets, you can take the id of the topmost tweet (i.e the most recent) and pass it as a since_id parameter to fetch recent tweets (i.e new tweets after that id). You can also take the id of the last tweet and pass it as max_id parameter to fetch tweets before that id. However, max_id (as documented and tested) may include the tweet with the passed id in the returned stream.</p>
<p>I don't know Twitter's reason for this but I think it shouldn't be so. If I want to get tweets before 'tweetA' and so passed the id of tweetA to the API, I shouldn't get tweetA as part of the returned array of tweets. Even since_id doesn't work this way.</p>
<p>My simple workaround for now is to reduce the id by 1 before passing to the API.</p>
<p><div class="highlight"><pre><code class="java"><span class="lineno">1</span> <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">jo</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;id_str&quot;</span><span class="o">);</span> 
<span class="lineno">2</span> <span class="kt">long</span> <span class="n">idL</span> <span class="o">=</span> <span class="n">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">id</span><span class="o">);</span> 
<span class="lineno">3</span> <span class="n">idL</span> <span class="o">-=</span> <span class="mi">1</span><span class="o">;</span> 
<span class="lineno">4</span> <span class="n">params</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;max_id&quot;</span><span class="o">,</span> <span class="n">idL</span><span class="o">+</span><span class="s">&quot;&quot;</span><span class="o">);</span> 
</code></pre></div></p>
        <p></p>
        <em><a href="http://twitter.com/kehers">Discuss on twitter.</a></em>
    </article>

    <footer>
      <a href="/">home</a> &middot; <a href="posts.html">posts</a> &middot; <a href="http://github.com/kehers/kehers.github.com">source</a> &middot; <a href="http://twitter.com/kehers">@kehers</a>
    </footer>
  </div>
</body>
</html>